### Настройка
- `Константы.рдв_ФормироватьХешОбъектов` - включает режим контроля данных, подсистема сохраняет контрольную сумму выгружаемого объекта, для сверки с внешней системой
### Настройка алгоритма расчета
- ОбщийМодуль.рдв_МодульИнтеграцииБизнесПроцессов (тот что указан в `рдв_ИнтеграцияПереопределяемый.ИмяМодуляБизнесЛогикиИнтеграции`). Для всех внешних систем добавить безусловную регистрацию ВыгружаемыеОбъекты.

```
Процедура ЗаполнитьПравилаРегистрации(ПравилаРегистрации) Экспорт
ВнешняяСистемы = Справочники.рдв_ВнешниеСистемы.Предопределенный("Имя");

...

ДобавитьПравилоРегистрации(ПравилаРегистрации, 
Метаданные.Справочники.рдв_ВыгружаемыеОбъекты, 
ВнешняяСистемы,
"АдресМетода",
"ВыгружаемыеОбъекты");
...
КонецПроцедуры

Процедура ДобавитьПравилоРегистрации(ПравилаРегистрации, 
										МетаданныеОбъекта, 
										ВнешняяСистема,  
										АдресМетода = "", 
										ИмяВидаСообщения = "")

	ВидСообщения = Неопределено;
	
	Если ЗначениеЗаполнено(ИмяВидаСообщения) Тогда
		ВидСообщения = Справочники.рдв_ВидыСообщенийИнтеграции.ПолучитьВидСообщения(ИмяВидаСообщения);
	КонецЕсли;
											
	ПравилоРегистрации = ПравилаРегистрации.Добавить();
	ПравилоРегистрации.МетаданныеОбъекта = МетаданныеОбъекта;
	ПравилоРегистрации.ВнешняяСистема = ВнешняяСистема;
	ПравилоРегистрации.АдресМетода = АдресМетода;
	ПравилоРегистрации.ВидСообщения = ВидСообщения;
	
КонецПроцедуры

```

- ОбщийМодуль.рдв_ФормированиеХешейОбъектовПереопределяемый указать имя модуля с бизнес логикой формирования хеша, за основу можно взять `рдв_ФормированиеХешейОбъектовДемо`
```
Функция ИмяМодуляБизнесЛогикиФормированияХеша() Экспорт

	Возврат "рдв_ФормированиеХешейОбъектовДемо";

КонецФункции
```

- ОбщийМодуль.рдв_ФормированиеХешейОбъектовДемо
```
// Описывает правила по которым будет рассчитан хеш объекта
// Если не будут заданы, то возможен расчет в методе ХешРассчитать
// по произвольному алгоритму
Функция ПравилаРасчетаХеша(ОбъектМетаданных, ПравилоКонвертации) Экспорт
	
	Если ОбъектМетаданных = Метаданные.Документы._ДемоЗаказПокупателя Тогда
		// На основании правил конвертации получили правила хеша
		ПравилаРасчетаХеша = рдв_КонтрольЦелостностиДанных.ПравилаРасчетаХешаИзПравилКонвертации(ПравилоКонвертации);
		
		Шапка = ПравилаРасчетаХеша.Шапка;
		ТабличныеЧасти = ПравилаРасчетаХеша.ТабличныеЧасти;
		
		// Изменили правила для относительное правил конвертации
		// для указанных реквизитов
		КлючевыеПоля_ДемоКонтрагенты(Шапка);
		КлючевыеПоля_ДемоДоговорыКонтрагентов(Шапка);
		
		Возврат ПравилаРасчетаХеша;

	// Формируем правила по произвольному алгоритму
	ИначеЕсли ОбъектМетаданных = Метаданные.Справочники._ДемоПартнеры Тогда
		
		ПравилаРасчетаХеша = рдв_КонтрольЦелостностиДанных.ПравилаРасчетаХешаИнициализировать();
		Шапка = ПравилаРасчетаХеша.Шапка;
		рдв_КонтрольЦелостностиДанных.ПравилаРасчетаХешаДобавитьПоле(Шапка, "Код");
		рдв_КонтрольЦелостностиДанных.ПравилаРасчетаХешаДобавитьПоле(Шапка, "Наименование");
		
		ТЧ = рдв_КонтрольЦелостностиДанных.ПравилаРачетаХешаДобавитьТабличнуюЧасть(ПравилаРасчетаХеша
																						, "КонтактнаяИнформация");
		рдв_КонтрольЦелостностиДанных.ПравилаРасчетаХешаДобавитьПоле(ТЧ, "Тип");
		рдв_КонтрольЦелостностиДанных.ПравилаРасчетаХешаДобавитьПоле(ТЧ, "Вид");
		рдв_КонтрольЦелостностиДанных.ПравилаРасчетаХешаДобавитьПоле(ТЧ, "Представление");
		
		Возврат ПравилаРасчетаХеша;
		
	КонецЕсли;
	
КонецФункции

```
- действия выше приведут к тому что:
	- будет сформировано сообщение обмена с набор служебных данных, в том числе с данными хеша
	- внешняя система (если 1с), запишет хеши в регистр рдв_ХешиСообщенийИнтеграции
	- внешняя система (если 1с) сериализует сообщение, рассчитает хеши полученных объектов, запишет в регистр рдв_ХешиСообщенийИнтеграции
	- сформирует служебное сообщение, куда поместит свои хеши
	- в итоге базы источник и приемник будут содержать хеши друг друга
	- сверить данные можно через отчет __рдв_СверкаПолнотыТочностиДанных__
Подорбнее [о процессе регистрации](5%20process%20of%20reg%20of%20changes.md)
